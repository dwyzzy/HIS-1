<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="shortcut icon" href="assets/img/logo-fav.png">
    <title>HIS</title>
    <link rel="stylesheet" type="text/css" href="assets/css/style_me.css"/>
    <link rel="stylesheet" type="text/css" href="assets/lib/perfect-scrollbar/css/perfect-scrollbar.min.css"/>
    <link rel="stylesheet" type="text/css" href="assets/lib/material-design-icons/css/material-design-iconic-font.min.css"/>
    <link rel="stylesheet" type="text/css" href="assets/lib/datatables/css/jquery.dataTables.css">
    <link rel="stylesheet" href="assets/css/style.css" type="text/css"/>
    <link rel="stylesheet" type="text/css" href="assets/libme/jquery-ui-1.12.1/jquery-ui.css"/>
</head>
<body>
<div class="be-wrapper be-fixed-sidebar">
    <!-- 顶部导航栏 -->
    <nav class="navbar navbar-default navbar-fixed-top be-top-header">
        <div class="container-fluid">
            <!-- 左上角log -->
            <div class="navbar-header">
                <a href="#" class="navbar-brand"></a>
            </div>

            <div class="be-right-navbar">
                <ul class="nav navbar-nav navbar-right be-user-nav">
                    <li class="dropdown">
                        <a href="#" data-toggle="dropdown" role="button" aria-expanded="false" class="dropdown-toggle">
                            <img src="assets/img/avatar.png" alt="Avatar">
                            <span class="user-name">医技医生</span>
                        </a>
                        <ul role="menu" class="dropdown-menu">
                            <li>
                                <div class="user-info">
                                    <div class="user-name">医技医生</div>
                                </div>
                            </li>
                            <li>
                            </li>
                        </ul>
                    </li>
                </ul>
                <div class="page-title"></div>
            </div>
        </div>
    </nav>

    <!-- 左侧边导航栏 -->
    <div class="be-left-sidebar">
        <div class="left-sidebar-wrapper"><a href="#" class="left-sidebar-toggle">Dashboard</a>
            <div class="left-sidebar-spacer">
                <div class="left-sidebar-scroll">
                    <div class="left-sidebar-content">
                        <ul class="sidebar-elements">
                            <li class="divider">菜单</li>
                            <li class="parent"><a href="#"><i class="icon mdi mdi-face"></i><span>医技医生</span></a>
                                <ul class="sub-menu">
                                    <li class="active"><a href="#">医技处置</a>
                                    </li>
                                    <li><a href="tech_info.html">医技管理</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 页面主内容 -->
    <div class="be-content">
        <div class="main-content container-fluid">
            <div class="row">
                <div class="col-sm-12">
                    <div class="panel panel-default panel-table">
                        <div class="panel-heading">医技处置
                        </div>
                        <div class="panel-body">
                            <table id="patient-table" class="table table-striped table-hover table-fw-widget">
                                <thead>
                                <tr>
                                    <th><input type="checkbox" id="select-all" value="1"></th>
                                    <th>病例号</th>
                                    <th>医技项目id</th>
                                    <th>医技项目名称</th>
                                    <th>项目类型</th>
                                    <th>项目状态</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>


<script src="assets/lib/jquery/jquery.min.js" type="text/javascript"></script>
<script src="assets/libme/jquery-ui-1.12.1/external/jquery/jquery.js" type="text/javascript"></script>
<script src="assets/libme/jquery-ui-1.12.1/jquery-ui.js" type="text/javascript"></script>
<script src="assets/lib/perfect-scrollbar/js/perfect-scrollbar.jquery.min.js" type="text/javascript"></script>
<script src="assets/js/main.js" type="text/javascript"></script>
<script src="assets/lib/bootstrap/dist/js/bootstrap.min.js" type="text/javascript"></script>
<script src="assets/lib/datatables/js/jquery.dataTables.min.js" type="text/javascript"></script>
<script src="assets/lib/datatables/js/dataTables.bootstrap.min.js" type="text/javascript"></script>
<script src="assets/lib/datatables/plugins/buttons/js/dataTables.buttons.js" type="text/javascript"></script>
<script src="assets/lib/datatables/plugins/buttons/js/buttons.html5.js" type="text/javascript"></script>
<script src="assets/lib/datatables/plugins/buttons/js/buttons.flash.js" type="text/javascript"></script>
<script src="assets/lib/datatables/plugins/buttons/js/buttons.print.js" type="text/javascript"></script>
<script src="assets/lib/datatables/plugins/buttons/js/buttons.colVis.js" type="text/javascript"></script>
<script src="assets/lib/datatables/plugins/buttons/js/buttons.bootstrap.js" type="text/javascript"></script>
<script src="assets/js/app-tables-datatables.js" type="text/javascript"></script>
<script src="assets/lib/layui/layui.all.js" type="text/javascript"></script>


<script type="text/javascript">
    import th from "./assets/lib/moment.js/src/locale/th";

    const data = [
        ["","3242323","120500003","中清创缝合","处置","待执行","确认执行"],
        ["","3242323","210101002","脑室碘水造影","检查","已执行","录入结果"],
        ["","3242323","210103009","尿β2微球蛋白测定（化X发光法）J","检验","已完成","查看结果"],
        ["","3242323","210103015","肠内高营养治疗","处置","已取消","查看结果"]
    ]
    $(document).ready(function(){
        App.init();
        init_doctor_table();
        init_table_checkbox();
    });

    function init_doctor_table(){
        const dataTableConfig = {
            "dom":"<'row be-datatable-header'<'col-sm-6' <'toolbar'>><'pull-right'B>>" +
            "<'row be-datatable-body'<'col-sm-12'tr>>" +
            "<'row be-datatable-footer'<'col-sm-6'i><'col-sm-6'p>>",

            "bPaginate": true,  //是否分页。
            "bStateSave": true,
            "aLengthMenu": [5, 10, 15],
            "language": {
                "processing": "数据查询中",
                "emptyTable": "在输入框中输入患者病例号/医技处置id以获取数据",
                "info": "显示 _START_ 到 _END_ 条数据 共 _TOTAL_ 条数据",
                "infoEmpty": "无数据",
                "infoFiltered": "(在 _MAX_ 条数据中查询)",
                "lengthMenu": "显示 _MENU_ 条数据",
                "search": "查询:",
                "zeroRecords": "没有找到对应的数据",
                "paginate": {
                    "previous":"上一页",
                    "next": "下一页",
                    "last": "末页",
                    "first": "首页"
                },
                sSearchPlaceholder: "病例号/医技项目id"
            },
            'columnDefs': [{
                'targets': 0,
                'searchable': false,
                'orderable': false,
                'render': function (data, type, full, meta){
                    return '<input type="checkbox" name="id[]" value="' + $('<div/>').text(data).html() + '">';
                }
            },{
                'targets': 6,
                'searchable': false,
                'orderable' : false,
                'render': function (data, type, full, meta) {
                    const button = $("<input type='button' class='btn btn-space btn-primary'>");
                    button.val(data);
                    if (data === "确认提交")
                        button.onclick(confirm(full, this));
                    else if (data === "录入结果")
                        button.onclick(input_result(full, this));
                    else if (data === "查看结果")
                        button.onclick(show_result(full, this));
                    else
                        button.text("不可达的按钮");

                    console.log(button.prop("outerHTML"));
                    return button.prop("outerHTML");
                }
            }
            ],
            "buttons": [
                {
                    text: "取消所选项目",
                    className: "btn btn-space btn-danger",
                    action:function () {
                        cancel_item();
                    }
                },
            ]
        };
        $("#patient-table").dataTable(dataTableConfig);
        $("div.toolbar").html("<input type='text' id='custom-search' placeholder='病例号/医技项目id' class='input-xs'>");
        $("#custom-search").autocomplete({
            source: ["3242323", "210103015", "210103009", "210101002", "120500003"],
            select: function () {
                search_and_fill_table();
            }
        })
        $("#custom-search").keyup(function (event) {
            if (event.keyCode === 13)
                search_and_fill_table();
        })
    }

    function init_table_checkbox() {
        $("#select-all").on('click', function () {
            const table = $("#patient-table").DataTable();
            // 获取所有显示在表格中的行
            const rows = table.rows({'search': 'applied'}).nodes();
            $('input[type="checkbox"]', rows).prop('checked', this.checked)
        })

        $("#patient-table tbody").on('change', 'input[type="checkbox"', function () {
            if (!this.checked){
                const el = $("#select-all").get(0);
                if (el && el.checked && ('indeterminate' in el)){
                    el.indeterminate = true;
                }
            }
        })

        // // Handle form submission event
        // $('#frm-example').on('submit', function(e){
        //     var form = this;
        //
        //     // Iterate over all checkboxes in the table
        //     table.$('input[type="checkbox"]').each(function(){
        //         // If checkbox doesn't exist in DOM
        //         if(!$.contains(document, this)){
        //             // If checkbox is checked
        //             if(this.checked){
        //                 // Create a hidden element
        //                 $(form).append(
        //                     $('<input>')
        //                         .attr('type', 'hidden')
        //                         .attr('name', this.name)
        //                         .val(this.value)
        //                 );
        //             }
        //         }
        //     });
        // });
    }

    function cancel_item() {

    }

    function search_and_fill_table() {
        const text = $("#custom-search").val();
        const table = $("#patient-table").DataTable();
        table.clear();
        for (let r of data){
            if (r[1] === text || r[2] === text){
                table.row.add(r);
            }
        }
        table.draw();
    }

    // 确认执行
    function confirm(row, bt) {

    }

    // 录入结果
    function input_result(row, bt) {

    }

    // 查看结果
    function show_result(row, bt) {

    }
</script>
</html>